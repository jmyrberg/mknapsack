"""Test cases for algorithms."""


import pytest

from mknapsack.algorithms import mtm  # Compile the latest version inplace


@pytest.mark.parametrize(
    'params',
    [
        {
            'p': [92, 57, 49, 68, 60, 43, 67, 84, 87, 72],
            'w': [23, 31, 29, 44, 53, 38, 63, 85, 89, 82],
            'c': [70, 127],
            'z': 333,
            'x': [0, 1, 1, 0, -1, -1, 1, -1, -1, -1]
        },
        {
            'p': [110, 150, 70, 80, 30, 5],
            'w': [40, 60, 30, 40, 20, 5],
            'c': [65, 85],
            'z': 345,
            'x': [1, 0, -1, 1, -1, 0]
        },
        {
            'p': [78, 35, 89, 36, 94, 75, 74, 79, 80, 16],
            'w': [18, 9, 23, 20, 59, 61, 70, 75, 76, 30],
            'c': [103, 156],
            'z': 452,
            'x': [0, -1, 0, 1, 1, 0, -1, -1, 1, -1]
        },
        {
            'p': [78, 35, 89, 36, 94, 75, 74, 79, 80, 16],
            'w': [18, 9, 23, 20, 59, 61, 70, 75, 76, 30],
            'c': [76, 110, 112],
            'z': 503,
            'x': [1, 1, 1, 2, 1, 2, -1, -1, 0, 2]
        },
        {
            'p': [78, 77, 35, 34, 33, 89, 88, 36, 35, 94, 93, 75, 74, 74, 73,
                  79, 78, 80, 79, 16, 15, 10],
            'w': [18, 18,  9,  9,  9, 23, 23, 20, 20, 59, 59, 61, 61, 70, 70,
                  75, 75, 76, 76, 30, 30, 40],
            'c': [80, 103, 109, 112],
            'z': 841,
            'x': None
        },
        {
            'p': [78, 77, 35, 34, 89, 88, 36, 35, 94, 93, 75, 74, 74, 73, 79,
                  78, 80, 79, 16, 15, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1],
            'w': [18, 18, 9, 9, 23, 23, 20, 20, 59, 59, 61, 61, 70, 70, 75, 75,
                  76, 76, 30, 30, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
            'c': [80, 90, 100, 110],
            'z': 779,
            'x': None
        },
        {
            'p': [78, 77, 35, 34, 33, 89, 88, 36, 35, 94, 93, 75, 74, 74, 73,
                  79, 78, 80, 79, 16, 15, 10],
            'w': [18, 18,  9,  9,  9, 23, 23, 20, 20, 59, 59, 61, 61, 70, 70,
                  75, 75, 76, 76, 30, 30, 40],
            'c': [112, 109, 80, 103],
            'z': 841,
            'x': None
        },
        {
            'p': [78, 77, 35, 34, 33, 89, 88, 36, 35, 94, 93, 75, 74, 74, 73,
                  79, 78, 80, 79, 16, 15, 10],
            'w': [18, 18,  9,  9,  9, 23, 23, 20, 20, 59, 59, 61, 61, 70, 70,
                  75, 75, 76, 76, 30, 30, 40],
            'c': [20, 40, 60, 80, 100],
            'z': 708,
            'x': None
        },
        {
            'p': [78, 77, 35, 34, 33, 89, 88, 36, 35, 94, 93, 75, 74, 74, 73,
                  79, 78, 80, 79, 16, 15, 10],
            'w': [18, 18,  9,  9,  9, 23, 23, 20, 20, 59, 59, 61, 61, 70, 70,
                  75, 75, 76, 76, 30, 30, 40],
            'c': [20, 30, 35, 40, 45, 100],
            'z': 615,
            'x': None
        },
        {
            'p': [63, 66, 65, 64, 64, 64, 64, 63, 64, 65, 3, 3, 3, 4, 4, 4, 5,
                  5, 5, 6, 6, 6],
            'w': [420, 510, 510, 420, 420, 390, 420, 510, 420, 510, 270, 300,
                  330, 360, 390, 420, 450, 480, 510, 540, 570, 600],
            'c': [1320, 1320, 1320, 1320],
            'z': 649,
            'x': None
        },
        {
            'p': [63, 66, 65, 64, 64, 64, 64, 63, 64, 65, 3, 3, 3, 4, 4, 4, 5,
                  5, 5, 6, 6, 6],
            'w': [420, 510, 510, 420, 420, 390, 420, 510, 420, 510, 270, 300,
                  330, 360, 390, 420, 450, 480, 510, 540, 570, 600],
            'c': [1320, 1320, 1320, 1320],
            'z': 649,
            'x': None
        },
        {
            'p': [1, 1],
            'w': [1, 1],
            'c': [2, 2],
            'z': 2,
            'x': None
        }
    ]
)
def test_mtm(params):
    expected_z = params.pop('z')
    expected_x = params.pop('x')
    z, x, bt, _ = mtm(**params)
    assert z == expected_z
    if expected_x:
        assert x == expected_x


def test_mtm_fail():
    # ValueError, when non-equal length
    try:
        mtm(p=[1, 2, 3, 4], w=[1, 5], c=[5])
        assert False
    except ValueError:
        assert True
    except Exception:
        assert False

    # Non-list inputs
    try:
        mtm(p=[1, 2, 3, 4], w=[1, 5], c=5)
        assert False
    except ValueError:
        assert True
    except Exception:
        assert False
